<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Go/No-Go Task</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      text-align: center;
      padding-top: 60px;
    }
    #stimulus {
      font-size: 80px;
      margin: 40px;
    }
    #message {
      font-size: 24px;
      margin: 20px;
    }
    #result, #feedback {
      font-size: 20px;
      margin-top: 20px;
      white-space: pre-wrap;
      text-align: center;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    #result {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #progressBar {
      width: 300px;
      height: 20px;
      background-color: #ddd;
      margin: 20px auto;
      border-radius: 10px;
      overflow: hidden;
    }
    #progressFill {
      height: 100%;
      background-color: #4caf50;
      width: 100%;
      transition: width 1.5s linear;
    }
    button {
      padding: 10px 25px;
      font-size: 20px;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>Go/No-Go Task</h1>
  <div id="message">æŒ‰ä¸‹ã€Œé–‹å§‹ã€é–‹å§‹ä»»å‹™</div>
  <div id="stimulus"></div>
  <div id="progressBar"><div id="progressFill"></div></div>
  <button onclick="startTask()">é–‹å§‹</button>
  <button onclick="manualResponse()">ğŸ–±ï¸ é»æ“Šåæ‡‰ï¼ˆGoï¼‰</button>
  <div id="feedback"></div>
  <div id="result"></div>

  <script>
    let trials = [];
    const totalTrials = 20;
    let currentTrial = 0;
    let startTime = 0;
    let results = [];
    let responseGiven = false;
    let progressTimeout;
    let autoNextTimeout;

    function generateTrials() {
      trials = [];
      for (let i = 0; i < totalTrials; i++) {
        const isGo = Math.random() < 0.7;
        trials.push({
          type: isGo ? 'go' : 'nogo',
          stimulus: isGo ? 'ğŸ”µ' : 'ğŸ”´',
          correct: isGo
        });
      }
    }

    function startTask() {
      generateTrials();
      results = [];
      currentTrial = 0;
      document.getElementById("message").textContent = "è«‹åœ¨çœ‹åˆ° ğŸ”µ æ™‚æŒ‰ç©ºç™½éµæˆ–é»æ“ŠæŒ‰éˆ•ï¼Œçœ‹åˆ° ğŸ”´ æ™‚ä¸è¦åæ‡‰ã€‚";
      document.getElementById("result").textContent = "";
      document.getElementById("feedback").textContent = "";
      nextTrial();
    }

    function nextTrial() {
      if (currentTrial >= trials.length) {
        const correctResponses = results.filter(r => r.correct).length;
        const total = results.length;
        const avgRT = Math.round(results.filter(r => r.rt !== null).reduce((a, b) => a + b.rt, 0) / results.filter(r => r.rt !== null).length || 0);
        const numGo = trials.filter(t => t.type === 'go').length;
        const numNoGo = trials.filter(t => t.type === 'nogo').length;
        const hits = results.filter((r, i) => trials[i].type === 'go' && r.correct).length;
        const falseAlarms = results.filter((r, i) => trials[i].type === 'nogo' && !r.correct).length;

        const summary = `æ¸¬é©—çµæŸï¼\n\nç¸½é¡Œæ•¸ï¼š${total} é¡Œ\nGo é¡Œæ•¸ï¼š${numGo}\nNo-Go é¡Œæ•¸ï¼š${numNoGo}\n\nâœ”ï¸ æ­£ç¢ºåæ‡‰æ¬¡æ•¸ï¼š${correctResponses}\nâŒ èª¤æ“Šï¼ˆNo-Go æ™‚æŒ‰ä¸‹ï¼‰ï¼š${falseAlarms}\nâ±ï¸ å¹³å‡åæ‡‰æ™‚é–“ï¼ˆé™ Go é¡Œï¼‰ï¼š${avgRT} ms`;
        document.getElementById("message").textContent = "å·²å®Œæˆæ¸¬é©—ã€‚";
        document.getElementById("stimulus").textContent = "";
        document.getElementById("result").textContent = summary;
        return;
      }

      const trial = trials[currentTrial];
      document.getElementById("stimulus").textContent = trial.stimulus;
      document.getElementById("feedback").textContent = "";
      startTime = Date.now();
      responseGiven = false;

      // Reset and animate progress bar
      const progressFill = document.getElementById("progressFill");
      progressFill.style.transition = "none";
      progressFill.style.width = "100%";
      setTimeout(() => {
        progressFill.style.transition = "width 1.5s linear";
        progressFill.style.width = "0%";
      }, 50);

      progressTimeout = setTimeout(() => {
        if (!responseGiven) {
          const correct = trial.type === 'nogo';
          results.push({ rt: null, correct });
          document.getElementById("feedback").textContent = correct ? "âœ… æ­£ç¢ºæŠ‘åˆ¶" : "âŒ éŒ¯éæ‡‰æŒ‰";
        }
      }, 1500);

      autoNextTimeout = setTimeout(() => {
        currentTrial++;
        nextTrial();
      }, 2000);
    }

    function manualResponse() {
      if (currentTrial < trials.length && !responseGiven) {
        responseGiven = true;
        clearTimeout(progressTimeout);
        clearTimeout(autoNextTimeout);
        const rt = Date.now() - startTime;
        const trial = trials[currentTrial];
        const correct = trial.type === 'go';
        results.push({ rt, correct });
        document.getElementById("feedback").textContent = correct ? `âœ… æ­£ç¢ºåæ‡‰ï¼ˆ${rt} msï¼‰` : "âŒ ä¸æ‡‰åæ‡‰";
        setTimeout(() => {
          currentTrial++;
          nextTrial();
        }, 500);
      }
    }

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && currentTrial < trials.length && !responseGiven) {
        manualResponse();
      }
    });
  </script>
</body>
</html>
